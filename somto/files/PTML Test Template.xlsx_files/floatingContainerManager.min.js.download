var floatingContainerManager=(window.webpackJsonp_name_=window.webpackJsonp_name_||[]).push([[17],{2036:function(t,e,n){"use strict";n.r(e),n.d(e,"FloatingContainerManagerFactoryGlobal",(function(){return Q}));var i,o,a,r=n(49),s=n(3),c=n(9),d=n(690);function l(t){switch(t){case d.a.CommentThread:return r.b.CommentThread;case d.a.TrackedChange:return r.b.TrackedChange;default:return r.b.CommentThread}}!function(t){t[t.msoulscat_Wac_Telemetry=383]="msoulscat_Wac_Telemetry"}(i||(i={})),function(t){t[t.Error=10]="Error",t[t.Warning=15]="Warning",t[t.Info=50]="Info",t[t.Verbose=100]="Verbose",t[t.Spam=200]="Spam"}(o||(o={})),function(t){t[t.containerVirtualizationEnabled=0]="containerVirtualizationEnabled"}(a||(a={}));var h,p=function(){function t(t,e){this.constructContainerId=t,this.ulsLogger=e}return t.prototype.getAggregateHeight=function(){throw new c.c("getAggregateHeight not implemented",c.d.reserveTag(589103755))},t.prototype.updateContainersPositions=function(e,n,a){var r,c;if(e&&a)try{for(var d=Object(s.__values)(e),l=d.next();!l.done;l=d.next()){var h=l.value;if(!h||!h.contentId||null===h.anchorLeft||void 0===h.anchorLeft||null===h.anchorRight||void 0===h.anchorRight||null===h.anchorBottom||void 0===h.anchorBottom)return void this.ulsLogger.sendTraceTag(595653592,i.msoulscat_Wac_Telemetry,o.Error,"invalid contentAnchorPosition");var p=n[this.getContainerId(h)];if(!p||!p.floatingContainerRef)return void this.ulsLogger.sendTraceTag(595653593,i.msoulscat_Wac_Telemetry,o.Error,"invalid floatingContainerInfo or floatingContainerRef");var u=t.calculateFloatingContainerPosition(h,a.viewportInfo,p.position,a.isContainerPreferredLeft);p.floatingContainerRef.updateContainerPosition({anchorPoint:{x:u.x,y:u.y},disableRepositioningAnimation:!0})}}catch(t){r={error:t}}finally{try{l&&!l.done&&(c=d.return)&&c.call(d)}finally{if(r)throw r.error}}else this.ulsLogger.sendTraceTag(595653591,i.msoulscat_Wac_Telemetry,o.Error,"invalid contentAnchorPositions or positionerOptions")},t.prototype.calculateNewPositions=function(t,e,n){throw new c.c("calculateNewPositions not implemented",c.d.reserveTag(589103756))},t.prototype.getContainerId=function(t){var e=t.contentId;return this.constructContainerId({contentId:e,contentType:l(t.containerContentType),renderMode:r.e.Isolated})},t.calculateFloatingContainerPosition=function(e,n,i,o){return{x:t.calculateFloatingContainerLeftPosition(e,n,i,o),y:t.calculateFloatingContainerTopPosition(e,n,i),height:i.height,width:i.width}},t.calculateFloatingContainerTopPosition=function(t,e,n){if(null===t.anchorBottom||void 0===t.anchorBottom)return n.y;var i=Math.max(t.anchorTop,e.y),o=i+n.height,a=e.height;if(t.anchorTop>a&&t.anchorBottom>a)return a-n.height;var r=i;return o>a&&(r=i-(o-a)),Math.max(e.y,r)},t.calculateFloatingContainerLeftPosition=function(t,e,n,i){if(null===t.anchorLeft||void 0===t.anchorLeft||null===t.anchorRight||void 0===t.anchorRight)return n.x;var o=Math.max(t.anchorRight,e.x),a=o+n.width,r=e.width;if(t.anchorLeft>r&&t.anchorRight>r)return r-n.width;var s=t.anchorLeft-n.width;return i?s<e.x&&a<r?o:s:a>r&&s>e.x?s:o},t}(),u=n(8),f=n(212),C=n(427),g=n(1),T=n(54),y=n(185);!function(t){t[t.Enablement=1]="Enablement",t[t.Focus=2]="Focus",t[t.Hover=3]="Hover",t[t.Resize=4]="Resize",t[t.Visibility=5]="Visibility"}(h||(h={}));var m,v=function(){function t(t){this.eventSink=t}return t.prototype.unsubscribe=function(){this.eventSink.unsubscribe(this)},t}(),I=function(){function t(){this.handlers=[]}return t.prototype.subscribe=function(t){var e=new v(this);return this.handlers.push({subscription:e,handler:t}),e},t.prototype.unsubscribe=function(t){this.handlers=this.handlers.filter((function(e){return e.subscription!==t}))},t.prototype.trigger=function(t){this.handlers.forEach((function(e){return e.handler(t,e.subscription)}))},t}(),b=n(282);function _(t,e){return{type:t,payload:e}}!function(t){t.ChangeRenderedContentIdentifierType="CHANGE_RENDERED_CONTENT_IDENTIFIER",t.EmptyActionType="",t.RemoveVisibilityAnimationType="REMOVE_VISIBILITY_ANIMATION",t.RepositionType="REPOSITION_FLOATING_CONTAINER",t.SetContentType="SET_CONTENT",t.UpdateContainerVirtualizationType="UPDATE_FLOATING_CONTAINER_VIRTUALIZATION",t.UpdateContainerVisibilityType="UPDATE_FLOATING_CONTAINER_VISIBILITY",t.UpdateContentMaxDimensionsType="UPDATE_CONTENT_MAX_DIMENSIONS",t.UpdateContentSetItemDetailsType="UPDATE_CONTENT_SET_ITEM_DETAILS"}(m||(m={}));var E={anchorPoint:{x:0,y:0}};function S(t,e){var n;return void 0===e&&(e=E),{anchorPoint:e.anchorPoint,contentIdentifier:t,disableRepositioningAnimation:!1,isVisible:!1,isVirtualized:!1,maxDimensions:e.maxDimensions||{},positionFixed:!1,useVisibilityAnimation:!1,accessibilityMetadata:null!==(n=e.accessibilityMetadata)&&void 0!==n?n:{}}}var R={contentId:"",contentType:r.b.Empty};function w(t,e){switch(void 0===t&&(t=S(R)),void 0===e&&(e=_(m.EmptyActionType,{})),e.type){case m.ChangeRenderedContentIdentifierType:return function(t,e){return t.contentIdentifier.contentId===e.payload.newContentIdentifier.contentId&&t.contentIdentifier.contentType===e.payload.newContentIdentifier.contentType?t:Object(s.__assign)(Object(s.__assign)({},t),{contentIdentifier:e.payload.newContentIdentifier})}(t,e);case m.RemoveVisibilityAnimationType:return function(t){return Object(s.__assign)(Object(s.__assign)({},t),{useVisibilityAnimation:!1})}(t);case m.RepositionType:return function(t,e){return t.anchorPoint.x===e.payload.anchorPoint.x&&t.anchorPoint.y===e.payload.anchorPoint.y&&t.disableRepositioningAnimation===e.payload.disableRepositioningAnimation&&t.positionFixed===e.payload.positionFixed?t:Object(s.__assign)(Object(s.__assign)({},t),{anchorPoint:e.payload.anchorPoint,disableRepositioningAnimation:e.payload.disableRepositioningAnimation,positionFixed:e.payload.positionFixed})}(t,e);case m.SetContentType:return function(t,e){return Object(s.__assign)(Object(s.__assign)({},t),{content:e.payload.content,isVisible:!!e.payload.content&&t.isVisible})}(t,e);case m.UpdateContentMaxDimensionsType:return function(t,e){return t.maxDimensions.height===e.payload.maxDimensions.height&&t.maxDimensions.width===e.payload.maxDimensions.width?t:Object(s.__assign)(Object(s.__assign)({},t),{maxDimensions:e.payload.maxDimensions})}(t,e);case m.UpdateContentSetItemDetailsType:return function(t,e){var n,i=null===(n=t.accessibilityMetadata)||void 0===n?void 0:n.setItem,o=e.payload.setItemDetails;return i===o||i&&o&&i.positionInSet===o.positionInSet&&i.setSize===o.setSize&&i.level===o.level?t:Object(s.__assign)(Object(s.__assign)({},t),{accessibilityMetadata:Object(s.__assign)(Object(s.__assign)({},t.accessibilityMetadata),{setItem:o})})}(t,e);case m.UpdateContainerVisibilityType:return function(t,e){return Object(s.__assign)(Object(s.__assign)({},t),{isVisible:e.payload.isVisible,useVisibilityAnimation:e.payload.useVisibilityAnimation})}(t,e);case m.UpdateContainerVirtualizationType:return function(t,e){return Object(s.__assign)(Object(s.__assign)({},t),{isVirtualized:e.payload.isVirtualized})}(t,e);default:return t}}function x(t){return _(m.SetContentType,{content:t})}var P=function(t){return t.isVirtualized},F=n(5),M=n(17),U=n(1183),D=Object(F.bb)({from:{opacity:0,visibility:"visible"},to:{opacity:1}}),L=Object(F.bb)({from:{opacity:1,visibility:"visible"},to:{opacity:0,visibility:"hidden"}}),V=Object(M.c)((function(t,e,n,i){return{floatingContainerView:Object(F.eb)({animationName:e?t?D:L:void 0,animationDuration:"".concat(300,"ms"),animationTimingFunction:U.c.decelerate,background:"transparent",position:i?"fixed":"absolute",transitionDuration:t&&!n?U.b.duration4:"0s",transitionProperty:"top, left",transitionTimingFunction:U.c.decelerate,visibility:t?"visible":"hidden"})}})),O=n(1569),A=n(1212);function W(t){return"floatingContainerView".concat(t.contentId,"Type").concat(t.contentType)}var j,z=function(t){function e(e){var n=t.call(this,e)||this;return n.handleResizeUpdates=function(t){t.forEach((function(t){n.props.onContainerStateChanged.trigger({stateChangeType:h.Resize,contentIdentifier:n.props.contentIdentifier,contentRect:t.contentRect})}))},n.triggerVisibilityUpdateNotification=function(){n.props.onContainerStateChanged.trigger({stateChangeType:h.Visibility,contentIdentifier:n.props.contentIdentifier,isVisible:n.props.isVisible})},n.getHostedResource=function(t){return{id:t}},n.onFocusChange=function(t,e){var i=t.relatedTarget||document.activeElement;n.parentDivRef&&i instanceof HTMLElement&&n.parentDivRef.contains(i)||n.props.onContainerStateChanged.trigger({stateChangeType:h.Focus,contentIdentifier:n.props.contentIdentifier,isFocused:e})},n.onFocusOut=function(t){n.onFocusChange(t,!1)},n.onFocusIn=function(t){n.onFocusChange(t,!0)},n.onMouseEnter=function(){n.props.onContainerStateChanged.trigger({stateChangeType:h.Hover,contentIdentifier:n.props.contentIdentifier,isHovered:!0})},n.onMouseLeave=function(){n.props.onContainerStateChanged.trigger({stateChangeType:h.Hover,contentIdentifier:n.props.contentIdentifier,isHovered:!1})},n.setContentRef=function(t){n.contentRef=t},n.setParentDivRef=function(t){t!==n.parentDivRef&&(n.parentDivRef&&(n.resizeObserver.unobserve(n.parentDivRef),n.parentDivRef.removeEventListener("focusin",n.onFocusIn,!0),n.parentDivRef.removeEventListener("focusout",n.onFocusOut,!0)),t&&(n.resizeObserver.observe(t),t.addEventListener("focusin",n.onFocusIn,!0),t.addEventListener("focusout",n.onFocusOut,!0))),n.parentDivRef=t},n.contentRef=void 0,n.parentDivRef=void 0,n.resizeObserver=new A.a((function(t){window.requestAnimationFrame((function(){n.handleResizeUpdates(t)}))})),n.setContentRef=n.setContentRef.bind(n),n.setParentDivRef=n.setParentDivRef.bind(n),n.getHostedResource=Object(O.a)(n.getHostedResource.bind(n)),n}return Object(s.__extends)(e,t),e.prototype.componentDidMount=function(){this.triggerVisibilityUpdateNotification()},e.prototype.componentDidUpdate=function(t){var e=this,n=!1;t.isVisible!==this.props.isVisible&&(this.props.useVisibilityAnimation&&!this.props.isVisible?n=!0:this.triggerVisibilityUpdateNotification()),this.props.useVisibilityAnimation&&setTimeout((function(){n&&e.triggerVisibilityUpdateNotification(),e.props.removeVisibilityAnimation()}),300)},e.prototype.height=function(){return this.parentDivRef?this.parentDivRef.clientHeight:0},e.prototype.width=function(){return this.parentDivRef?this.parentDivRef.clientWidth:0},e.prototype.setFocus=function(){this.contentRef&&this.contentRef.focus()},e.prototype.render=function(){if(!this.props.anchorPoint||void 0===this.props.anchorPoint.x||void 0===this.props.anchorPoint.y||!this.props.content)return null;var t=V(this.props.isVisible,this.props.useVisibilityAnimation,this.props.disableRepositioningAnimation,this.props.positionFixed),e=this.props.content;return g.createElement("div",{key:W(this.props.contentIdentifier),id:W(this.props.contentIdentifier),ref:this.setParentDivRef,className:t.floatingContainerView,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,style:{left:this.props.anchorPoint.x,top:this.props.anchorPoint.y}},g.createElement(e,{componentRef:this.setContentRef,resource:this.getHostedResource(this.props.contentIdentifier.contentId),maximumDimensions:this.props.maxDimensions,isVirtualized:this.props.isVirtualized,accessibilityMetadata:this.props.accessibilityMetadata}))},e}(g.Component),H=Object(y.connect)((function(t){return{accessibilityMetadata:t.accessibilityMetadata,anchorPoint:t.anchorPoint,content:t.content,contentIdentifier:t.contentIdentifier,disableRepositioningAnimation:t.disableRepositioningAnimation,isVisible:t.isVisible,isVirtualized:t.isVirtualized,maxDimensions:t.maxDimensions,positionFixed:t.positionFixed,useVisibilityAnimation:t.useVisibilityAnimation}}),(function(t,e){return{removeVisibilityAnimation:function(){t(_(m.RemoveVisibilityAnimationType,{}))}}}),void 0,{forwardRef:!0})(z),k=function(){function t(t,e,n,i){var o;this.onContainerStateChanged=new I,this.floatingContainerRef=void 0,this.extensionUpdatedEventSubscription=void 0,this.unsubscribeStoreListener=function(){},this.canShow=!1,!1===i.isDraftContainer&&(this.floatingContainerCreationActivity=Object(u.k)().createActivityObject("FloatingContainerCreation",Object(u.l)(u.g.GlobalAPI),Object(u.j)())),this.store=(o=S(n,i))?Object(b.createStore)(w,o):Object(b.createStore)(w),this.extensionProvider=e,this.setContentFromExtension(),this.parentDiv=document.createElement("div"),this.parentDiv.id=i.containerId||Object(f.a)(),t.appendChild(this.parentDiv),this.observeStore=this.observeStore.bind(this),this.onUpdatedEventHandler=this.onUpdatedEventHandler.bind(this),this.setFloatingContainerRef=this.setFloatingContainerRef.bind(this),this.observeStore(n),this.render()}return t.prototype.anchorPoint=function(){return this.store.getState().anchorPoint},t.prototype.contentIdentifier=function(){return this.store.getState().contentIdentifier},t.prototype.height=function(){return this.floatingContainerRef?this.floatingContainerRef.height():0},t.prototype.width=function(){return this.floatingContainerRef?this.floatingContainerRef.width():0},t.prototype.parentDivId=function(){return this.parentDiv.id},t.prototype.observeStore=function(t){var e=this;if(Object(r.i)(this.extensionProvider)){var n=t;this.unsubscribeStoreListener=this.store.subscribe((function(){var t=e.contentIdentifier();n.contentId===t.contentId&&n.contentType===t.contentType||(n=t,e.removeExtensionUpdatedEventSubscription(),e.setContentFromExtension())}))}},t.prototype.setContentFromExtension=function(){var t=this,e=void 0;if(Object(r.i)(this.extensionProvider)){if(e=this.extensionProvider.getExtension(this.contentIdentifier().contentId),this.extensionUpdatedEventSubscription||(this.extensionUpdatedEventSubscription=e.onUpdated.subscribe((function(e){t.onUpdatedEventHandler()}))),e.priority===r.d.Disabled)return this.canShow=!1,void this.store.dispatch(x(void 0))}else e=this.extensionProvider.getExtension();this.canShow=!0,Object(C.d)().getComponent(e.componentKey).then((function(e){t.store.dispatch(x(e.component)),t.floatingContainerCreationActivity&&(t.floatingContainerCreationActivity.successTag(593872975),t.floatingContainerCreationActivity=void 0)})).catch((function(t){Object(u.k)().assertConditionTag(!1,"Error when registering component in setContentFromExtension ".concat(t),595632583)}))},t.prototype.render=function(){var t={onContainerStateChanged:this.onContainerStateChanged};T.render(g.createElement(y.Provider,{store:this.store},g.createElement(H,Object(s.__assign)({ref:this.setFloatingContainerRef},t))),this.parentDiv)},t.prototype.updateContainerPosition=function(t){var e,n,i;this.store.dispatch((e=t.anchorPoint,n=!!t.disableRepositioningAnimation,i=!!t.positionFixed,_(m.RepositionType,{anchorPoint:e,disableRepositioningAnimation:n,positionFixed:i})))},t.prototype.updateMaximumDimensions=function(t){this.store.dispatch(function(t){return _(m.UpdateContentMaxDimensionsType,{maxDimensions:t})}(t))},t.prototype.updateSetItemDetails=function(t){this.store.dispatch(function(t){return _(m.UpdateContentSetItemDetailsType,{setItemDetails:t})}(t))},t.prototype.updateContainerVirtualization=function(t){t&&!P(this.store.getState())?this.store.dispatch(_(m.UpdateContainerVirtualizationType,{isVirtualized:!0})):P(this.store.getState())&&this.store.dispatch(_(m.UpdateContainerVirtualizationType,{isVirtualized:!1}))},t.prototype.showFloatingContainer=function(t){return!!this.canShow&&(this.store.dispatch(function(t){return _(m.UpdateContainerVisibilityType,{isVisible:!0,useVisibilityAnimation:t})}(!!t)),!0)},t.prototype.hideFloatingContainer=function(t){this.store.dispatch(function(t){return _(m.UpdateContainerVisibilityType,{isVisible:!1,useVisibilityAnimation:t})}(!!t))},t.prototype.destroyFloatingContainer=function(t){var e=this;this.unsubscribeStoreListener(),this.removeExtensionUpdatedEventSubscription(),this.hideFloatingContainer(t),t?setTimeout((function(){e.cleanupDomOnDestroy()}),300):this.cleanupDomOnDestroy()},t.prototype.cleanupDomOnDestroy=function(){T.unmountComponentAtNode(this.parentDiv),this.parentDiv.parentElement&&this.parentDiv.parentElement.removeChild(this.parentDiv)},t.prototype.isShowing=function(){return this.store.getState().isVisible},t.prototype.setFocus=function(){var t=this;this.floatingContainerRef?this.floatingContainerRef.setFocus():setTimeout((function(){var e;return null===(e=t.floatingContainerRef)||void 0===e?void 0:e.setFocus()}))},t.prototype.changeRenderedContentIdentifier=function(t){this.store.dispatch(function(t){return _(m.ChangeRenderedContentIdentifierType,{newContentIdentifier:t})}(t))},t.prototype.onUpdatedEventHandler=function(){var t=this.canShow;this.setContentFromExtension(),t!==this.canShow&&this.onContainerStateChanged.trigger({stateChangeType:h.Enablement,contentIdentifier:this.contentIdentifier(),isEnabled:this.canShow})},t.prototype.removeExtensionUpdatedEventSubscription=function(){this.extensionUpdatedEventSubscription&&(this.extensionUpdatedEventSubscription.unsubscribe(),this.extensionUpdatedEventSubscription=void 0)},t.prototype.setFloatingContainerRef=function(t){this.floatingContainerRef=null!=t?t:void 0},t}(),N=new(function(){function t(){}return t.prototype.createFloatingContainer=function(t,e,n,i){return new k(t,e,n,i)},t}()),B=n(80);!function(t){t[t.ContainerAdded=0]="ContainerAdded",t[t.ContainerDeleted=1]="ContainerDeleted",t[t.ContainerFocused=2]="ContainerFocused",t[t.ContainerManagerInitialized=3]="ContainerManagerInitialized",t[t.ContainerResized=4]="ContainerResized"}(j||(j={}));var G=n(20),q=n(79),J=n(213),Y=function(){function t(t,e,n,i,o){var a=this;this.containerIdToInfoMap={},this.containerIdToShowHideTimersMap={},this.supportedContentTypes=[r.b.CommentThread],this.isIsolatedExtensionProviderRegistered=!1,this.onContainerStateChanged=function(t){var e,n=t.contentIdentifier.contentId,i=K({contentId:n,contentType:t.contentIdentifier.contentType,renderMode:r.e.Isolated}),o=a.containerIdToInfoMap[i];if(o&&o.floatingContainerRef)switch(t.stateChangeType){case h.Enablement:t.isEnabled?o.floatingContainerRef.showFloatingContainer():o.floatingContainerRef.hideFloatingContainer();break;case h.Hover:t.isHovered?(a.clearShowHideTimersForContainer(i),o.isMouseWithin=!0):(o.isMouseWithin=!1,o.isSticky||a.requestDeleteContainerWithDelay({contentId:n,containerContentType:0}));break;case h.Focus:t.isFocused&&o&&(o.isSticky=!0,a.onContainerChangedCallback&&a.onContainerChangedCallback({contentId:n,containerChangeType:j.ContainerFocused}));break;case h.Resize:if(a.isViewportInitialized()&&a.onContainerChangedCallback){o.position.height=t.contentRect.height,o.position.width=t.contentRect.width;var s=[o.anchorPosition];a.floatingContainerPositioner.updateContainersPositions(s,a.containerIdToInfoMap,{viewportInfo:a.viewportInfo,isContainerPreferredLeft:a.isRtl}),a.focusContainerId===i&&(null===(e=o.floatingContainerRef)||void 0===e||e.setFocus(),a.ULS.sendTraceTag(555860383,q.a.msoulscat_Wac_Telemetry,J.a.Info,"Set focus to container with ID ".concat(a.focusContainerId)),a.focusContainerId=void 0)}}},this.showFloatingContainer=function(t){var e=a.containerIdToInfoMap[t].floatingContainerRef;e?Object(G.isChangeGateEnabled)("OfficeVSO:4218437_deeplink_extensionpriority")?a.extensionProviderCollection&&a.extensionProviderCollection.providers.forEach((function(n){if(n.scope.contentType===r.b.CommentThread&&n.scope.renderMode===r.e.Isolated){var i=n.getExtension(t.split("_")[0]);i.isContentIdValid&&i.priority!==r.d.Disabled?(e.showFloatingContainer(),a.cachedContainerIdToShow=void 0):(a.cachedContainerIdToShow=t,a.extensionUpdatedEventSubscription=i.onUpdated.subscribe((function(){return a.onIsolatedExtensionUpdated()})),a.ULS.sendTraceTag(590991682,q.a.msoulscat_Wac_Telemetry,J.a.Info,"Subscribed to extension update for ".concat(a.cachedContainerIdToShow)))}})):e.showFloatingContainer():a.ULS.sendTraceTag(507303838,q.a.msoulscat_Wac_Telemetry,J.a.Warning,"container not found")},this.contentExtensionHostAPIGetter=t,this.floatingContainerPositioner=e,this.ULS=n,this.floatingContainerFactory=i,this.contentTypeToExtensionProviderMap=new Map,this.initializeExtensionProviderCollection(),this.onContainerChangedCallback=o,this.isRtl=!1,this.viewportInfo={x:0,y:0,width:0,height:0},this.focusContainerId=void 0,this.cachedContainerIdToShow=void 0,this.extensionUpdatedEventSubscription=void 0}return t.prototype.setFloatingContainerParentElement=function(t){var e=!this.floatingContainerParentElement;this.floatingContainerParentElement=t,e&&this.canCreateFloatingContainers()&&this.onContainerChangedCallback&&this.onContainerChangedCallback({containerChangeType:j.ContainerManagerInitialized,contentId:null}),this.floatingContainerPositioner||this.ULS.sendTraceTag(590991631,q.a.msoulscat_Wac_Telemetry,J.a.Error,"null floatingcontainerpositioner")},t.prototype.updateViewport=function(t,e){this.viewportInfo=t,this.isRtl=e},t.prototype.isViewportInitialized=function(){return 0!==this.viewportInfo.height&&0!==this.viewportInfo.width},t.prototype.focusContainer=function(t){var e;if(t&&t.contentId){var n=K({contentId:t.contentId,contentType:l(t.containerContentType),renderMode:r.e.Isolated});null===(e=this.containerIdToInfoMap[n].floatingContainerRef)||void 0===e||e.setFocus()}else this.ULS.sendTraceTag(541188373,q.a.msoulscat_Wac_Telemetry,J.a.Error,"null contentAnchorPosition")},t.prototype.addAndShowContainer=function(t,e){if(t&&t.contentId){if(e){var n=K({contentId:t.contentId,contentType:l(t.containerContentType),renderMode:r.e.Isolated});this.focusContainerId=n,this.ULS.sendTraceTag(555860382,q.a.msoulscat_Wac_Telemetry,J.a.Info,"Waiting to set focus to container with ID ".concat(this.focusContainerId))}this.addContainerCore(t,!0)}else this.ULS.sendTraceTag(590991632,q.a.msoulscat_Wac_Telemetry,J.a.Error,"null contentAnchorPosition")},t.prototype.addContainer=function(t){t?this.addContainerCore(t,!0):this.ULS.sendTraceTag(590991633,q.a.msoulscat_Wac_Telemetry,J.a.Error,"null contentAnchorPosition")},t.prototype.updateContainer=function(t){if(t&&t.contentId&&null!==t.anchorLeft&&void 0!==t.anchorLeft)if(this.canCreateFloatingContainers()){var e=K({contentId:t.contentId,contentType:l(t.containerContentType),renderMode:r.e.Isolated});if(this.isViewportInitialized()){var n=[t];this.floatingContainerPositioner.updateContainersPositions(n,this.containerIdToInfoMap,{viewportInfo:this.viewportInfo,isContainerPreferredLeft:this.isRtl}),this.containerIdToInfoMap[e].anchorPosition=t}else{var i=this.containerIdToInfoMap[e];if(!i||!i.floatingContainerRef)return void this.ULS.sendTraceTag(590991636,q.a.msoulscat_Wac_Telemetry,J.a.Warning,"unknown floating container");i.floatingContainerRef.updateContainerPosition({anchorPoint:{x:t.anchorLeft,y:t.anchorTop}})}}else this.ULS.sendTraceTag(590991635,q.a.msoulscat_Wac_Telemetry,J.a.Error,"floatingContainerManager state not initialized");else this.ULS.sendTraceTag(590991634,q.a.msoulscat_Wac_Telemetry,J.a.Error,"invalid contentAnchorPosition")},t.prototype.deleteContainer=function(t){if(t)if(t.contentId)if(this.canCreateFloatingContainers()){var e=K({contentId:t.contentId,contentType:l(t.containerContentType),renderMode:r.e.Isolated}),n=this.containerIdToInfoMap[e];n&&n.floatingContainerRef?(this.cachedContainerIdToShow===e&&(this.removeExtensionUpdatedEventSubscription(),this.ULS.sendTraceTag(590991640,q.a.msoulscat_Wac_Telemetry,J.a.Info,"Unsubscribed to extension update for ".concat(this.cachedContainerIdToShow," on destroy"))),n.floatingContainerRef.destroyFloatingContainer(),delete this.containerIdToInfoMap[e],this.onContainerChangedCallback&&this.onContainerChangedCallback({contentId:t.contentId,containerChangeType:j.ContainerDeleted})):this.ULS.sendTraceTag(590991641,q.a.msoulscat_Wac_Telemetry,J.a.Warning,"container not found")}else this.ULS.sendTraceTag(590991639,q.a.msoulscat_Wac_Telemetry,J.a.Error,"floatingContainerManager state not initialized");else this.ULS.sendTraceTag(590991638,q.a.msoulscat_Wac_Telemetry,J.a.Error,"null contentId");else this.ULS.sendTraceTag(590991637,q.a.msoulscat_Wac_Telemetry,J.a.Error,"null containerContentDescriptor")},t.prototype.requestAddContainerWithDelay=function(t){var e=this;if(t&&t.contentId){var n=K({contentId:t.contentId,contentType:l(t.containerContentType),renderMode:r.e.Isolated}),i=this.containerIdToInfoMap[n];if(this.clearShowHideTimersForContainer(n),!i||!i.floatingContainerRef){var o=setTimeout((function(){e.hideAllPendingContainers(),e.addContainerCore(t,!1),e.clearShowHideTimersForContainer(n)}),150);this.containerIdToShowHideTimersMap[n]=Object(s.__assign)(Object(s.__assign)({},this.containerIdToShowHideTimersMap[n]),{showTimer:o})}}else this.ULS.sendTraceTag(590991642,q.a.msoulscat_Wac_Telemetry,J.a.Error,"invalid contentAnchorPosition")},t.prototype.requestDeleteContainerWithDelay=function(t){var e=this;if(t&&t.contentId){var n=K({contentId:t.contentId,contentType:l(t.containerContentType),renderMode:r.e.Isolated}),i=this.containerIdToInfoMap[n];if(i&&i.floatingContainerRef){if(!i.isSticky&&!i.isMouseWithin){this.clearShowHideTimersForContainer(n);var o=setTimeout((function(){e.deleteContainer(t),e.clearShowHideTimersForContainer(n)}),200);this.containerIdToShowHideTimersMap[n]=Object(s.__assign)(Object(s.__assign)({},this.containerIdToShowHideTimersMap[n]),{hideTimer:o})}}else this.clearShowHideTimersForContainer(n)}else this.ULS.sendTraceTag(590991643,q.a.msoulscat_Wac_Telemetry,J.a.Error,"invalid containerContentDescriptor")},t.prototype.changeContentId=function(t,e){if(t&&t.contentId&&e){var n=l(t.containerContentType),i=K({contentId:t.contentId,contentType:n,renderMode:r.e.Isolated}),o=K({contentId:e,contentType:n,renderMode:r.e.Isolated}),a=this.containerIdToInfoMap[i];a&&a.floatingContainerRef?(a.floatingContainerRef.changeRenderedContentIdentifier({contentId:e,contentType:n}),this.containerIdToInfoMap[o]=a,delete this.containerIdToInfoMap[i]):this.ULS.sendTraceTag(590991645,q.a.msoulscat_Wac_Telemetry,J.a.Warning,"container not found")}else this.ULS.sendTraceTag(590991644,q.a.msoulscat_Wac_Telemetry,J.a.Error,"invalid containerContentDescriptor or contentId")},t.prototype.setContainerStickyState=function(t,e){if(t&&t.contentId){var n=K({contentId:t.contentId,contentType:l(t.containerContentType),renderMode:r.e.Isolated});this.containerIdToInfoMap[n].isSticky=e}else this.ULS.sendTraceTag(543768912,q.a.msoulscat_Wac_Telemetry,J.a.Error,"invalid containerContentDescriptor or contentId")},t.prototype.isCommentThreadPreferredInFloatie=function(t){if(!t)return this.ULS.sendTraceTag(590991681,q.a.msoulscat_Wac_Telemetry,J.a.Warning,"IsolatedFloatingContainerManager.isCommentThreadPreferredInFloatie : containerId is null"),!1;if(!this.contentTypeToExtensionProviderMap)return this.ULS.sendTraceTag(507306136,q.a.msoulscat_Wac_Telemetry,J.a.Warning,"IsolatedFloatingContainerManager.isCommentThreadPreferredInFloatie : there is no contentTypeToExtensionProviderMap"),!1;var e=this.contentTypeToExtensionProviderMap.get(r.b.CommentThread);return e?e.getExtension(t.split("_")[0]).priority===r.d.Primary:(this.ULS.sendTraceTag(507306135,q.a.msoulscat_Wac_Telemetry,J.a.Warning,"IsolatedFloatingContainerManager.isCommentThreadPreferredInFloatie : there is no CommentThread provider"),!1)},t.prototype.addContainerCore=function(t,e){if(t.contentId)if(this.canCreateFloatingContainers()){var n=t.contentId,i=K({contentId:n,contentType:l(t.containerContentType),renderMode:r.e.Isolated});this.initializeFloatingContainersState(t,e)&&(this.showFloatingContainer(i),this.onContainerChangedCallback&&this.onContainerChangedCallback({contentId:n,containerChangeType:j.ContainerAdded}))}else this.ULS.sendTraceTag(590991647,q.a.msoulscat_Wac_Telemetry,J.a.Error,"floatingContainerManager state not initialized");else this.ULS.sendTraceTag(590991646,q.a.msoulscat_Wac_Telemetry,J.a.Error,"null contentId")},t.prototype.canCreateFloatingContainers=function(){return!!this.extensionProviderCollection&&this.isIsolatedExtensionProviderRegistered&&!!this.floatingContainerParentElement},t.prototype.initializeExtensionProviderCollection=function(){var t=this;this.extensionProviderCollection=this.contentExtensionHostAPIGetter().getExtensions(this.supportedContentTypes,r.c),this.updateContentTypeToExtensionProviderMap(),this.extensionProviderCollection.onUpdated.subscribe((function(){return t.updateContentTypeToExtensionProviderMap()}))},t.prototype.initializeFloatingContainersState=function(t,e){var n=this.contentTypeToExtensionProviderMap.get(l(t.containerContentType));if(!n)return this.ULS.sendTraceTag(590991648,q.a.msoulscat_Wac_Telemetry,J.a.Error,"ExtensionDescriptor not found"),!1;var i=t.contentId;if(!i)return this.ULS.sendTraceTag(590991649,q.a.msoulscat_Wac_Telemetry,J.a.Error,"null contentId"),!1;var o=K({contentId:i,contentType:l(t.containerContentType),renderMode:r.e.Isolated}),a=this.createFloatingContainer(n,t);return a?(a.onContainerStateChanged.subscribe(this.onContainerStateChanged),this.containerIdToInfoMap[o]=Object(s.__assign)(Object(s.__assign)({},this.containerIdToInfoMap[o]),{floatingContainerRef:a,isSticky:e,isMouseWithin:!1,anchorPosition:t,position:{x:t.anchorRight,y:t.anchorTop,height:0,width:0}}),!0):(this.ULS.sendTraceTag(590991650,q.a.msoulscat_Wac_Telemetry,J.a.Error,"floatingContainer not created"),!1)},t.prototype.updateContentTypeToExtensionProviderMap=function(){var t=this;void 0!==this.extensionProviderCollection?this.extensionProviderCollection.providers.forEach((function(e){e.scope.contentType===r.b.CommentThread&&e.scope.renderMode===r.e.Isolated&&(t.contentTypeToExtensionProviderMap.set(e.scope.contentType,e),t.isIsolatedExtensionProviderRegistered||(t.isIsolatedExtensionProviderRegistered=!0,t.canCreateFloatingContainers()&&t.onContainerChangedCallback&&t.onContainerChangedCallback({containerChangeType:j.ContainerManagerInitialized,contentId:null})))})):this.ULS.sendTraceTag(590991651,q.a.msoulscat_Wac_Telemetry,J.a.Error,"null extensionProviderCollection")},t.prototype.removeExtensionUpdatedEventSubscription=function(){this.extensionUpdatedEventSubscription&&(this.extensionUpdatedEventSubscription.unsubscribe(),this.extensionUpdatedEventSubscription=void 0)},t.prototype.onIsolatedExtensionUpdated=function(){this.cachedContainerIdToShow&&(this.removeExtensionUpdatedEventSubscription(),this.ULS.sendTraceTag(590991680,q.a.msoulscat_Wac_Telemetry,J.a.Info,"Unsubscribed to extension update for ".concat(this.cachedContainerIdToShow)),this.showFloatingContainer(this.cachedContainerIdToShow))},t.prototype.createFloatingContainer=function(t,e){if(this.floatingContainerParentElement){var n;if(this.isViewportInitialized()){if(null===e.anchorLeft||void 0===e.anchorLeft||null===e.anchorRight||void 0===e.anchorRight||null===e.anchorBottom||void 0===e.anchorBottom||null===e.anchorTop||void 0===e.anchorTop)return void this.ULS.sendTraceTag(590991684,q.a.msoulscat_Wac_Telemetry,J.a.Error,"invalid anchor");n=this.floatingContainerFactory.createFloatingContainer(this.floatingContainerParentElement,t,{contentId:e.contentId,contentType:l(e.containerContentType)},{anchorPoint:{x:e.anchorRight,y:e.anchorTop},maxDimensions:{height:this.viewportInfo.height}})}else{if(null===e.anchorLeft||void 0===e.anchorLeft)return void this.ULS.sendTraceTag(590991685,q.a.msoulscat_Wac_Telemetry,J.a.Error,"invalid anchorLeft");n=this.floatingContainerFactory.createFloatingContainer(this.floatingContainerParentElement,t,{contentId:e.contentId,contentType:l(e.containerContentType)},{anchorPoint:{x:e.anchorLeft,y:e.anchorTop}})}return n}this.ULS.sendTraceTag(590991683,q.a.msoulscat_Wac_Telemetry,J.a.Error,"floatingContainerParentElement not set")},t.prototype.clearShowHideTimersForContainer=function(t){var e=this.containerIdToShowHideTimersMap[t];e&&(e.showTimer&&clearTimeout(e.showTimer),e.hideTimer&&clearTimeout(e.hideTimer),delete this.containerIdToShowHideTimersMap[t])},t.prototype.hideAllPendingContainers=function(){for(var t in this.containerIdToShowHideTimersMap){var e=this.containerIdToShowHideTimersMap[t];e&&e.hideTimer&&(clearTimeout(e.hideTimer),delete e.hideTimer,this.deleteContainer(Z(t)))}},t.prototype.cancelDeleteContainerRequest=function(t){if(t)if(t.contentId){var e=K({contentType:l(t.containerContentType),renderMode:r.e.Isolated,contentId:t.contentId}),n=this.containerIdToShowHideTimersMap[e];n&&n.hideTimer&&(clearTimeout(n.hideTimer),delete n.hideTimer)}else this.ULS.sendTraceTag(590991687,q.a.msoulscat_Wac_Telemetry,J.a.Error,"null contentId");else this.ULS.sendTraceTag(590991686,q.a.msoulscat_Wac_Telemetry,J.a.Error,"null containerContentDescriptor")},t}();function K(t){return"".concat(t.contentId,"_").concat(t.contentType,"_").concat(t.renderMode)}function X(t){switch(t){case r.b.TrackedChange:return d.a.TrackedChange;case r.b.CommentThread:default:return d.a.CommentThread}}function Z(t){var e=t.split("_");return{contentId:e[0],containerContentType:X(parseInt(e[1],10))}}var Q=new(function(){function t(){}return t.prototype.getIsolatedFloatingContainerManagerInstance=function(){return this.getIsolatedFloatingContainerManagerInstanceWithCallback(void 0)},t.prototype.getIsolatedFloatingContainerManagerInstanceWithCallback=function(t){if(void 0===this.isolatedFloatingContainerManagerInstance){var e=new p(K,B.a);this.isolatedFloatingContainerManagerInstance=new Y(r.g,e,B.a,N,t)}return this.isolatedFloatingContainerManagerInstance},t}())}},[[2036,2,0,1]]]);
//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/floatingContainerManager.min.js.map/ab30e2d6cd986275f6ac2e9fd168fc84/floatingContainerManager.min.js.map